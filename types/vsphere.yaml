node_types:

  clearwater.nodes.MonitoredServer:
    derived_from: cloudify.vsphere.nodes.Server
    properties:
      cloudify_agent:
        default:
          user: { get_input: agent_user }
          key: { get_input: agent_key_file }
      server:
        default:
          template: { get_input: template_name }
          cpus: { get_input: vm_cpu }
          memory: { get_input: vm_memory }
      networking:
        default:
          dns_servers: { get_input: dns_servers }
          connect_networks:
            - name: { get_input: network }
              switch_distributed: { get_input: switch_distributed }
              management: True
              external: True
              use_dhcp: True
    interfaces:
      cloudify.interfaces.monitoring_agent:
        install:
          implementation: diamond.diamond_agent.tasks.install
          inputs:
            diamond_config:
              default:
                interval: 5
        start: diamond.diamond_agent.tasks.start
        stop: diamond.diamond_agent.tasks.stop
        uninstall: diamond.diamond_agent.tasks.uninstall

      cloudify.interfaces.monitoring:
          start:
            implementation: diamond.diamond_agent.tasks.add_collectors
            inputs:
              collectors_config:
                default:
                  CPUCollector: {}
                  MemoryCollector: {}
                  LoadAverageCollector: {}
                  DiskUsageCollector:
                    config:
                      devices: x?vd[a-z]+[0-9]*$
                  NetworkCollector: {}
